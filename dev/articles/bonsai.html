<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to bonsai • bonsai</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to bonsai">
<meta name="robots" content="noindex">
<script defer data-domain="bonsai.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bonsai</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/bonsai.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/bonsai/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to bonsai</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/bonsai/blob/main/vignettes/bonsai.Rmd" class="external-link"><code>vignettes/bonsai.Rmd</code></a></small>
      <div class="d-none name"><code>bonsai.Rmd</code></div>
    </div>

    
    
<p>The goal of bonsai is to provide bindings for additional tree-based
model engines for use with the {parsnip} package.</p>
<p>If you’re not familiar with parsnip, you can read more about the
package on it’s <a href="https://parsnip.tidymodels.org" class="external-link">website</a>.</p>
<p>To get started, load bonsai with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bonsai.tidymodels.org/">bonsai</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: parsnip</span></span></code></pre></div>
<p>To illustrate how to use the package, we’ll fit some models to a
dataset containing measurements on 3 different species of penguins.
Loading in that data and checking it out:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeldata.tidymodels.org" class="external-link">modeldata</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'modeldata'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:datasets':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     penguins</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [344 × 7] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ species          : Factor w/ 3 levels "Adelie","Chinstrap",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ island           : Factor w/ 3 levels "Biscoe","Dream",..: 3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span><span class="co">#&gt;  $ bill_length_mm   : num [1:344] 39.1 39.5 40.3 NA 36.7 39.3 38.9 39.2 34.1 42 ...</span></span>
<span><span class="co">#&gt;  $ bill_depth_mm    : num [1:344] 18.7 17.4 18 NA 19.3 20.6 17.8 19.6 18.1 20.2 ...</span></span>
<span><span class="co">#&gt;  $ flipper_length_mm: int [1:344] 181 186 195 NA 193 190 181 195 193 190 ...</span></span>
<span><span class="co">#&gt;  $ body_mass_g      : int [1:344] 3750 3800 3250 NA 3450 3650 3625 4675 3475 4250 ...</span></span>
<span><span class="co">#&gt;  $ sex              : Factor w/ 2 levels "female","male": 2 1 1 NA 1 2 1 2 NA NA ...</span></span></code></pre></div>
<p>Specifically, making use of our knowledge of which island that they
live on and measurements on their flipper length, we will predict their
species using a decision tree. We’ll first do so using the engine
<code>"rpart"</code>, which is supported with parsnip alone:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># specify and fit model</span></span>
<span><span class="va">dt_mod</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/decision_tree.html" class="external-link">decision_tree</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"rpart"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">species</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">island</span>, </span>
<span>    data <span class="op">=</span> <span class="va">penguins</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">dt_mod</span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; n= 344 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; node), split, n, loss, yval, (yprob)</span></span>
<span><span class="co">#&gt;       * denotes terminal node</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  1) root 344 192 Adelie (0.441860465 0.197674419 0.360465116)  </span></span>
<span><span class="co">#&gt;    2) flipper_length_mm&lt; 206.5 214  64 Adelie (0.700934579 0.294392523 0.004672897)  </span></span>
<span><span class="co">#&gt;      4) island=Biscoe,Torgersen 96   1 Adelie (0.989583333 0.000000000 0.010416667) *</span></span>
<span><span class="co">#&gt;      5) island=Dream 118  55 Chinstrap (0.466101695 0.533898305 0.000000000)  </span></span>
<span><span class="co">#&gt;       10) flipper_length_mm&lt; 192.5 59  20 Adelie (0.661016949 0.338983051 0.000000000) *</span></span>
<span><span class="co">#&gt;       11) flipper_length_mm&gt;=192.5 59  16 Chinstrap (0.271186441 0.728813559 0.000000000) *</span></span>
<span><span class="co">#&gt;    3) flipper_length_mm&gt;=206.5 130   7 Gentoo (0.015384615 0.038461538 0.946153846)  </span></span>
<span><span class="co">#&gt;      6) island=Dream,Torgersen 7   2 Chinstrap (0.285714286 0.714285714 0.000000000) *</span></span>
<span><span class="co">#&gt;      7) island=Biscoe 123   0 Gentoo (0.000000000 0.000000000 1.000000000) *</span></span></code></pre></div>
<p>From this output, we can see that the model generally first looks to
<code>island</code> to determine species, and then makes use of a mix of
flipper length and island to ultimately make a species prediction.</p>
<p>A benefit of using parsnip and bonsai is that, to use a different
implementation of decision trees, we simply change the engine argument
to <code>set_engine</code>; all other elements of the interface stay the
same. For instance, using <code>"partykit"</code>—which implements a
type of decision tree called a <em>conditional inference tree</em>—as
our backend instead:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/decision_tree.html" class="external-link">decision_tree</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"partykit"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">species</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">island</span>, </span>
<span>    data <span class="op">=</span> <span class="va">penguins</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model formula:</span></span>
<span><span class="co">#&gt; species ~ flipper_length_mm + island</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fitted party:</span></span>
<span><span class="co">#&gt; [1] root</span></span>
<span><span class="co">#&gt; |   [2] island in Biscoe</span></span>
<span><span class="co">#&gt; |   |   [3] flipper_length_mm &lt;= 203</span></span>
<span><span class="co">#&gt; |   |   |   [4] flipper_length_mm &lt;= 196: Adelie (n = 38, err = 0.0%)</span></span>
<span><span class="co">#&gt; |   |   |   [5] flipper_length_mm &gt; 196: Adelie (n = 7, err = 14.3%)</span></span>
<span><span class="co">#&gt; |   |   [6] flipper_length_mm &gt; 203: Gentoo (n = 123, err = 0.0%)</span></span>
<span><span class="co">#&gt; |   [7] island in Dream, Torgersen</span></span>
<span><span class="co">#&gt; |   |   [8] island in Dream</span></span>
<span><span class="co">#&gt; |   |   |   [9] flipper_length_mm &lt;= 192: Adelie (n = 59, err = 33.9%)</span></span>
<span><span class="co">#&gt; |   |   |   [10] flipper_length_mm &gt; 192: Chinstrap (n = 65, err = 26.2%)</span></span>
<span><span class="co">#&gt; |   |   [11] island in Torgersen: Adelie (n = 52, err = 0.0%)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of inner nodes:    5</span></span>
<span><span class="co">#&gt; Number of terminal nodes: 6</span></span></code></pre></div>
<p>This model, unlike the first, relies on recursive conditional
inference to generate its splits. As such, we can see it generates
slightly different results. Read more about this implementation of
decision trees in <code><a href="https://parsnip.tidymodels.org/reference/details_decision_tree_partykit.html" class="external-link">?details_decision_tree_partykit</a></code>.</p>
<p>One generalization of a decision tree is a <em>random forest</em>,
which fits a large number of decision trees, each independently of the
others. The fitted random forest model combines predictions from the
individual decision trees to generate its predictions.</p>
<p>bonsai introduces support for random forests using the
<code>partykit</code> engine, which implements an algorithm called a
<em>conditional random forest</em>. Conditional random forests are a
type of random forest that uses conditional inference trees (like the
one we fit above!) for its constituent decision trees.</p>
<p>To fit a conditional random forest with partykit, our code looks
pretty similar to that which we we needed to fit a conditional inference
tree. Just switch out <code><a href="https://parsnip.tidymodels.org/reference/decision_tree.html" class="external-link">decision_tree()</a></code> with
<code><a href="https://parsnip.tidymodels.org/reference/rand_forest.html" class="external-link">rand_forest()</a></code> and remember to keep the engine set as
<code>"partykit"</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rf_mod</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/rand_forest.html" class="external-link">rand_forest</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"partykit"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">species</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">island</span>, </span>
<span>    data <span class="op">=</span> <span class="va">penguins</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Read more about this implementation of random forests in
<code><a href="https://parsnip.tidymodels.org/reference/details_rand_forest_partykit.html" class="external-link">?details_rand_forest_partykit</a></code>.</p>
<p>Another generalization of a decision tree is a series of decision
trees where <em>each tree depends on the results of previous
trees</em>—this is called a <em>boosted tree</em>. bonsai implements an
additional parsnip engine for this model type called
<code>lightgbm</code>. To make use of it, start out with a
<code>boost_tree</code> model spec and set
<code>engine = "lightgbm"</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bt_mod</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/boost_tree.html" class="external-link">boost_tree</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"lightgbm"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">species</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">island</span>, </span>
<span>    data <span class="op">=</span> <span class="va">penguins</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">bt_mod</span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; LightGBM Model (100 trees)</span></span>
<span><span class="co">#&gt; Objective: multiclass (3 classes)</span></span>
<span><span class="co">#&gt; Fitted to dataset with 2 columns</span></span></code></pre></div>
<p>Read more about this implementation of boosted trees in
<code><a href="https://parsnip.tidymodels.org/reference/details_boost_tree_lightgbm.html" class="external-link">?details_boost_tree_lightgbm</a></code>.</p>
<p>Each of these model specs and engines have several arguments and
tuning parameters that affect user experience and results greatly. We
recommend reading about each of these parameters and tuning them when
you find them relevant for your modeling use case.</p>
  </main>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Daniel Falbel, Athos Damiani, Roel M. Hogervorst, <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, Simon Couch, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
